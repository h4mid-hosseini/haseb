{% load humanize %}
{% load jformat %}
<!DOCTYPE html>
{% if invoice.language == 'fa' %}
<html lang="fa" dir="rtl">
{% else %}
<html lang="en-us" dir="ltr">
{% endif %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>فاکتور</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <style>
        /* Optimized for A5 portrait paper size */
        @page {
            size: A5 portrait;
            margin: 10mm;
        }

        /* Font improvements */
        @font-face {
            font-family: 'Arad';
            src: url('/static/fonts/Arad/AradFD-RegularDots1.woff2');
        }

        .container {
            font-family: 'Roboto', sans-serif; /* for English */
            font-family: 'IranSans', sans-serif; /* for Persian */
        }

        h2, h4 {
            font-weight: bold;
        }

        h2 {
            font-size: 1.8em;
        }

        h4 {
            font-size: 1.4em;
        }

        p {
            font-size: 1.1em;
        }

        /* Table styling */
        table th, table td {
            padding: 8px;
            text-align: center;
        }

        /* General card styling */
        .card {
            border-radius: 10px;
            margin: 10px;
        }

        /* Responsive adjustments */
        @media print {
            .card {
                box-shadow: none;
                border: 1px solid #000;
            }
        }
    </style>
</head>
<body>

{% if invoice.language == 'fa' %}

<div class="container mt-5">
    <div class="card">
        <div class="card-header text-center">
            <h2>فاکتور</h2>
        </div>
        <div class="card-body">
            <!-- Company and Customer Information -->
            <div class="row">
                <div class="col-sm-6">
                    <h4>مشخصات فروشنده:</h4>
                    <p>
                        {{invoice.owner.company}}<br>
                        {{ invoice.owner.address }}<br>
                        تلفن: {{ invoice.owner.phone }}<br>
                        ایمیل: {{ invoice.owner.email }}
                    </p>
                </div>
                <div class="col-sm-6 text-sm-start">
                    <h4>مشتری:</h4>
                    <p>
                        {{ invoice.customer.name }}<br>
                        {{ invoice.customer.address }}<br>
                        تلفن: {{ invoice.customer.phone }}<br>
                        {{ invoice.customer.email }}
                    </p>
                </div>
            </div>
            <hr>
            <!-- Invoice Info -->
            <div class="row">
                <div class="col-sm-6">
                    <p>شناسه فاکتور: {{invoice.owner.id}}-{{ invoice.unique_code }}</p>
                    <p>تاریخ: {{ invoice.created_at |jformat:"%d-%m-%Y" }}</p>
                </div>
                <div class="col-sm-6 text-sm-start">
                    <p>تاریخ سررسید: {{ invoice.payment_deadline | jformat:"%d-%m-%Y" }}</p>
                </div>
            </div>
            <!-- Table for Items -->
            <table class="table table-bordered table-striped mt-4">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>توضیحات</th>
                        <th>تعداد</th>
                        <th>قیمت واحد</th>
                        <th>مجموع</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in invoice.items.all %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ item.title }}</td>
                        <td>{{ item.quantity | intcomma:False }}</td>
                        <td>{{ item.price | intcomma:False }}</td>
                        <td>{{ item.total | intcomma:False }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr>
                        <th colspan="4" class="text-end">جمع کل</th>
                        <th>{{ total_invoice_price | intcomma:False }} ریال</th>
                    </tr>
                    <tr>
                        <th colspan="4" class="text-end">مالیات</th>
                        <th>{{ tax_fee | intcomma:False }} ریال</th>
                    </tr>
                    <tr>
                        <th colspan="4" class="text-end">مجموع نهایی</th>
                        <th>{{ total_with_tax | intcomma:False }} ریال</th>
                    </tr>
                </tfoot>
            </table>
            <div class="text-end mt-3">
                <p><strong>مبلغ قابل پرداخت: {{ total_with_tax | intcomma:False }} ریال</strong></p>
            </div>
            <div class="row">
                <div class="col-sm-2"> </div>
                <div class="col-sm-4">
                    <p>{% if invoice.owner.sign_image %} <img src="{{ invoice.owner.sign_image.url }}" style="max-height: 150px;"> {% endif %}<br> امضا فروشنده</p>
                </div>
                <div class="col-sm-2"> </div>
                <div class="col-sm-4">
                    <p>امضا مشتری</p>
                </div>
            </div>
        </div>
    </div>
</div>

{% elif invoice.language == 'en' %}

<div class="container mt-5">
    <div class="card">
        <div class="card-header text-center">
            <h2>Invoice</h2>
        </div>
        <div class="card-body">
            <!-- Company and Customer Information -->
            <div class="row">
                <div class="col-sm-6">
                    <h4>Seller:</h4>
                    <p>
                        {{invoice.owner.company}}<br>
                        {{ invoice.owner.address }}<br>
                        Phone: {{ invoice.owner.phone }}<br>
                        Email: {{ invoice.owner.email }}
                    </p>
                </div>
                <div class="col-sm-6 text-sm-start">
                    <h4>Customer:</h4>
                    <p>
                        {{ invoice.customer.name }}<br>
                        {{ invoice.customer.address }}<br>
                        Phone: {{ invoice.customer.phone }}<br>
                        {{ invoice.customer.email }}
                    </p>
                </div>
            </div>
            <hr>
            <!-- Invoice Info -->
            <div class="row">
                <div class="col-sm-6">
                    <p>Invoice ID: {{invoice.owner.id}}-{{ invoice.unique_code }}</p>
                    <p>Date: {{ invoice.created_at |jformat:"%d-%m-%Y" }}</p>
                </div>
                <div class="col-sm-6 text-sm-start">
                    <p>Payment Deadline: {{ invoice.payment_deadline | jformat:"%d-%m-%Y" }}</p>
                </div>
            </div>
            <!-- Table for Items -->
            <table class="table table-bordered table-striped mt-4">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Description</th>
                        <th>Quantity</th>
                        <th>Unit Price</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in invoice.items.all %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ item.title }}</td>
                        <td>{{ item.quantity | intcomma:False }}</td>
                        <td>{{ item.price | intcomma:False }}</td>
                        <td>{{ item.total | intcomma:False }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr>
                        <th colspan="4" class="text-end">Subtotal</th>
                        <th>{{ total_invoice_price | intcomma:False }} {{ invoice.currency }}</th>
                    </tr>
                    <tr>
                        <th colspan="4" class="text-end">Tax</th>
                        <th>{{ tax_fee | intcomma:False }} {{ invoice.currency }}</th>
                    </tr>
                    <tr>
                        <th colspan="4" class="text-end">Total</th>
                        <th>{{ total_with_tax | intcomma:False }} {{ invoice.currency }}</th>
                    </tr>
                </tfoot>
            </table>
            <div class="text-end mt-3">
                <p><strong>Total Payable: {{ total_with_tax | intcomma:False }} {{ invoice.currency }}</strong></p>
            </div>
        </div>
    </div>
</div>

{% endif %}
</body>
</html>
